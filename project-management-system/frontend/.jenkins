pipeline {
    agent any

    environment {
        PROJECT_NAME = "Project Management Application"
        REPO_PATH = "C:\\ProgramData\\Jenkins\\.jenkins\\workspace\\first_pipeline"
        FRONTEND_DIR = "project-management-system\\frontend" // Path to frontend
        BACKEND_DIR = "project-management-system\\backend"   // Path to backend
    }

    stages {
        stage('Source') {
            steps {
                script {
                    echo 'Cloning repository...'
                    git url: 'https://github.com/Chahak081/flexiprojectfinal.git', branch: 'main'
                }
            }
        }
        stage('Checkout Code') {
            steps {
               checkout scmGit(branches: [[name: '*/main']], extensions: [], userRemoteConfigs: [[credentialsId: '9d1659d9-812c-478d-907c-333968a6a13c', url: 'https://github.com/Chahak081/flexiprojectfinal.git']])
            }
        }

        stage('Build') {
            parallel {
                stage('Build Frontend') {
                    steps {
                        dir("${env.REPO_PATH}\\${env.FRONTEND_DIR}") {
                            echo 'Installing Node.js dependencies for frontend...'
                            bat 'npm ci' // Install frontend dependencies
                            echo 'Building frontend application...'
                            bat 'set CI=false && npm run build' // Build frontend application
                        }
                    }
                }

                stage('Build Backend') {
                    steps {
                        dir("${env.REPO_PATH}\\${env.BACKEND_DIR}") {
                            echo 'Installing Node.js dependencies for backend...'
                            bat 'npm ci' // Install backend dependencies
                            echo 'No build step needed for backend'
                            // Add backend build command if necessary
                        }
                    }
                }
            }
        }

        // stage('Test') {
//   parallel {
//       stage('Test Frontend') {
//           steps {
//               dir("${env.REPO_PATH}\\${env.FRONTEND_DIR}") {
//                   echo 'Running frontend tests...'
//                   bat 'npm test' // Run frontend tests
//               }
//           }
//       }

//       stage('Test Backend') {
//           steps {
//               dir("${env.REPO_PATH}\\${env.BACKEND_DIR}") {
//                   echo 'Running backend tests...'
//                   // Add backend test command if necessary
//               }
//           }
//       }
//   }
// }
        stage('Deploy') {
            steps {
                script {
                    echo 'Deploying applications...'
                    // Add deployment scripts/commands for frontend and backend
                }
            }
        }
    }

    post {
        always {
            echo "Pipeline finished."
        }
        success {
            echo "The pipeline was successful."
        }
        failure {
            echo "The pipeline failed."
        }
    }
}
